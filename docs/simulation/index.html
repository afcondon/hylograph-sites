<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hylograph-simulation - Hylograph</title>
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="../lib.css">
</head>
<body>
  <header class="lib-header">
    <a href="../" class="back-link">Hylograph Project Documentation</a>
  </header>

  <main class="lib-page">
    <h1>hylograph-simulation</h1>

    <article class="readme">
<h1
id="purescript-hylograph-simulation">purescript-hylograph-simulation</h1>
<p><a href="/#/force-playground"><img
src="../../site/lib-simulation/public/demo.jpeg"
alt="Force Playground Demo" /></a></p>
<p>Force-directed graph simulation with unified D3 and WASM engine
support.</p>
<h2 id="quick-start">Quick Start</h2>
<div class="sourceCode" id="cb1"><pre
class="sourceCode purescript"><code class="sourceCode purescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">Main</span> <span class="kw">where</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Prelude</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Effect</span> (<span class="dt">Effect</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Effect.Console</span> (log)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Nullable</span> (null) <span class="kw">as</span> <span class="dt">Nullable</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Hylograph.Simulation</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  ( runSimulation, <span class="dt">Engine</span>(<span class="op">..</span>), <span class="dt">SimulationEvent</span>(<span class="op">..</span>), subscribe</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  , setup, manyBody, center, withStrength, withX, withY, static</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Hylograph.AST</span> <span class="kw">as</span> <span class="dt">A</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Hylograph.Unified.Attribute</span> <span class="kw">as</span> <span class="dt">Attr</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Hylograph.Unified.Display</span> (showNumD)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Hylograph.Internal.Selection.Types</span> (<span class="dt">ElementType</span>(..))</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="ot">main ::</span> <span class="dt">Effect</span> <span class="dt">Unit</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Run simulation with D3 engine (or use WASM for same API)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  { handle, events } <span class="ot">&lt;-</span> runSimulation</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    { engine<span class="op">:</span> <span class="dt">D3</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    , setup<span class="op">:</span> setup <span class="st">&quot;physics&quot;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        [ manyBody <span class="st">&quot;charge&quot;</span> <span class="op">#</span> withStrength (static (<span class="op">-</span><span class="fl">50.0</span>))</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        , center <span class="st">&quot;center&quot;</span> <span class="op">#</span> withX (static <span class="fl">200.0</span>) <span class="op">#</span> withY (static <span class="fl">150.0</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    , nodes<span class="op">:</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        [ { <span class="fu">id</span><span class="op">:</span> <span class="dv">0</span>, x<span class="op">:</span> <span class="fl">190.0</span>, y<span class="op">:</span> <span class="fl">140.0</span>, vx<span class="op">:</span> <span class="fl">0.0</span>, vy<span class="op">:</span> <span class="fl">0.0</span>, fx<span class="op">:</span> Nullable.null, fy<span class="op">:</span> Nullable.null }</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>        , { <span class="fu">id</span><span class="op">:</span> <span class="dv">1</span>, x<span class="op">:</span> <span class="fl">200.0</span>, y<span class="op">:</span> <span class="fl">150.0</span>, vx<span class="op">:</span> <span class="fl">0.0</span>, vy<span class="op">:</span> <span class="fl">0.0</span>, fx<span class="op">:</span> Nullable.null, fy<span class="op">:</span> Nullable.null }</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        , { <span class="fu">id</span><span class="op">:</span> <span class="dv">2</span>, x<span class="op">:</span> <span class="fl">210.0</span>, y<span class="op">:</span> <span class="fl">160.0</span>, vx<span class="op">:</span> <span class="fl">0.0</span>, vy<span class="op">:</span> <span class="fl">0.0</span>, fx<span class="op">:</span> Nullable.null, fy<span class="op">:</span> Nullable.null }</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    , links<span class="op">:</span> []</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    , container<span class="op">:</span> <span class="st">&quot;#visualization&quot;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    , nodeTemplate<span class="op">:</span> \_ <span class="ot">-&gt;</span> A.elem <span class="dt">Circle</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        [ Attr.attr <span class="st">&quot;cx&quot;</span> _<span class="op">.</span>x showNumD</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>        , Attr.attr <span class="st">&quot;cy&quot;</span> _<span class="op">.</span>y showNumD</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>        , Attr.attrStatic <span class="st">&quot;r&quot;</span> <span class="st">&quot;8&quot;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        , Attr.attrStatic <span class="st">&quot;fill&quot;</span> <span class="st">&quot;#4a9eff&quot;</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    , alphaMin<span class="op">:</span> <span class="fl">0.001</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">-- Subscribe to simulation events</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  _ <span class="ot">&lt;-</span> subscribe events \event <span class="ot">-&gt;</span> <span class="kw">case</span> event <span class="kw">of</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Tick</span> { alpha } <span class="ot">-&gt;</span> <span class="fu">log</span> <span class="op">$</span> <span class="st">&quot;Alpha: &quot;</span> <span class="op">&lt;&gt;</span> <span class="fu">show</span> alpha</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Completed</span> <span class="ot">-&gt;</span> <span class="fu">log</span> <span class="st">&quot;Simulation converged!&quot;</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    _ <span class="ot">-&gt;</span> <span class="fu">pure</span> unit</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log</span> <span class="st">&quot;Simulation running!&quot;</span></span></code></pre></div>
<h2 id="installation">Installation</h2>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">spago</span> install hylograph-simulation</span></code></pre></div>
<h2 id="features">Features</h2>
<ul>
<li><strong>Dual Engine Support</strong> - Same API for D3.js and
Rust/WASM physics</li>
<li><strong>Framework Agnostic</strong> - Works with Halogen, React, or
vanilla JS</li>
<li><strong>Declarative Forces</strong> - Compose forces with a fluent
builder API</li>
<li><strong>Event Subscription</strong> - React to Tick, Started,
Stopped, Completed events</li>
<li><strong>GUP Semantics</strong> - Enter/update/exit tracking when
data changes</li>
</ul>
<h2 id="halogen-integration">Halogen Integration</h2>
<div class="sourceCode" id="cb3"><pre
class="sourceCode purescript"><code class="sourceCode purescript"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Hylograph.ForceEngine.Halogen</span> (toHalogenEmitter)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>handleAction <span class="dt">Initialize</span> <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  { handle, events } <span class="ot">&lt;-</span> liftEffect <span class="op">$</span> runSimulation config</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  halogenEmitter <span class="ot">&lt;-</span> liftEffect <span class="op">$</span> toHalogenEmitter events</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  void <span class="op">$</span> H.subscribe <span class="op">$</span> halogenEmitter <span class="op">&lt;#&gt;</span> <span class="dt">SimEvent</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>handleAction (<span class="dt">SimEvent</span> (<span class="dt">Tick</span> { alpha })) <span class="ot">=</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  H.modify_ _ { alpha <span class="ot">=</span> alpha }</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>handleAction (<span class="dt">SimEvent</span> <span class="dt">Completed</span>) <span class="ot">=</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  liftEffect <span class="op">$</span> <span class="fu">log</span> <span class="st">&quot;Done!&quot;</span></span></code></pre></div>
<h2 id="react-integration">React Integration</h2>
<div class="sourceCode" id="cb4"><pre
class="sourceCode javascript"><code class="sourceCode javascript"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">useEffect</span>(() <span class="kw">=&gt;</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> { handle<span class="op">,</span> events } <span class="op">=</span> <span class="fu">runSimulation</span>(config)()<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> unsubscribe <span class="op">=</span> <span class="fu">subscribe</span>(events)(<span class="bu">event</span> <span class="kw">=&gt;</span> {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">event</span><span class="op">.</span><span class="at">tag</span> <span class="op">===</span> <span class="st">&#39;Completed&#39;</span>) {</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">&#39;Simulation converged!&#39;</span>)<span class="op">;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  })()<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> () <span class="kw">=&gt;</span> <span class="fu">unsubscribe</span>()<span class="op">;</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> [])<span class="op">;</span></span></code></pre></div>
<h2 id="available-forces">Available Forces</h2>
<table>
<thead>
<tr>
<th>Force</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>manyBody</code></td>
<td>N-body charge simulation (attract/repel)</td>
</tr>
<tr>
<td><code>center</code></td>
<td>Pulls nodes toward a center point</td>
</tr>
<tr>
<td><code>link</code></td>
<td>Spring forces between connected nodes</td>
</tr>
<tr>
<td><code>collide</code></td>
<td>Prevents node overlap</td>
</tr>
<tr>
<td><code>positionX</code></td>
<td>Pulls nodes toward an X position</td>
</tr>
<tr>
<td><code>positionY</code></td>
<td>Pulls nodes toward a Y position</td>
</tr>
<tr>
<td><code>radial</code></td>
<td>Pulls nodes toward a circle</td>
</tr>
</tbody>
</table>
<h2 id="modules">Modules</h2>
<ul>
<li><code>Hylograph.Simulation</code> - High-level API
(recommended)</li>
<li><code>Hylograph.Simulation.Emitter</code> - Framework-agnostic event
system</li>
<li><code>Hylograph.ForceEngine.Setup</code> - Declarative force
configuration</li>
<li><code>Hylograph.ForceEngine.Simulation</code> - Low-level D3
simulation control</li>
<li><code>Hylograph.ForceEngine.WASM</code> - WASM engine
integration</li>
</ul>
<h2 id="part-of-hylograph">Part of Hylograph</h2>
<p>This package is part of the Hylograph visualization ecosystem: -
<strong>hylograph-selection</strong> - D3 selection and rendering -
<strong>hylograph-simulation</strong> - Force simulation (this package)
- <strong>hylograph-simulation-halogen</strong> - Halogen integration -
<strong>hylograph-graph</strong> - Graph data structures -
<strong>hylograph-layout</strong> - Layout algorithms</p>
<h2 id="license">License</h2>
<p>MIT</p>
    </article>

    <aside class="lib-links">
      <a href="https://pursuit.purescript.org/packages/purescript-hylograph-simulation" class="pursuit-link">API Docs (Pursuit)</a>
      <a href="https://github.com/afcondon/purescript-hylograph-simulation" class="github-link">GitHub</a>
    </aside>
  </main>
</body>
</html>
